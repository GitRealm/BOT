print("Running HoleTest")
io.write("How wide: ")
inputWidth = io.read()
io.write("How deep: ")
inputDepth = io.read()
print()
print("----------------------------")
print("Digging a " .. inputWidth .. "x" .. inputWidth .. "x" .. inputDepth .. " quarry.")
print("----------------------------")
print()
local function digRow(rowLength,increment,level)
    for x=1, rowLength,1 do
        if turtle.detect() then turtle.dig() end
        turtle.forward()
    end
    if increment == rowLength then return end
    if increment%2 == 0 then turnRight() else turnLeft() end
end

local function digPlane(width,level)
    if level == 1 then
        digRow(width,0,level)
    elseif level%2 == 0 then
        digRow(width-1,0,level)
    else
        digRow(width-1,0,level)
    end
    for i=1,width-1,1 do
        digRow(width-1,i,level)
    end
end

function switchPlane()
    turtle.turnRight()
    turtle.turnRight()
    if turtle.detectDown() then turtle.digDown() end
    turtle.down()
end

function turnLeft()
    turtle.turnLeft()
    if turtle.detect() then turtle.dig() end
    turtle.forward()
    turtle.turnLeft()
end

function turnRight()
    turtle.turnRight()
    if turtle.detect() then turtle.dig() end
    turtle.forward()
    turtle.turnRight()
end

local function quarry(width,depth)
    for plane=1,depth,1 do
        print("Digging level " .. plane)
        digPlane(width,plane)
        print("Level " .. plane .. " is now finished.")
        if plane == tonumber(depth) then
            print()
            print("----------------------------")
            print()
            print("Done")
            return end
        print("Switching to level " .. plane+1)
        switchPlane()
        print()
    end
end

quarry(inputWidth,inputDepth)
